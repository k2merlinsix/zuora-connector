/**
 * Mule Zuora Cloud Connector
 *
 * Copyright (c) MuleSoft, Inc.  All rights reserved.  http://www.mulesoft.com
 *
 * The software in this package is published under the terms of the CPAL v1.0
 * license, a copy of which has been included with this distribution in the
 * LICENSE.txt file.
 */

/**
 * This file was automatically generated by the Mule Development Kit
 */
package org.mule.modules.zuora;

import org.mule.api.annotations.Configurable;
import org.mule.api.annotations.Module;
import org.mule.api.annotations.Processor;
import org.mule.api.annotations.param.Optional;
import org.mule.modules.zuora.zobject.ZObject;
import org.mule.modules.zuora.zuora.api.SfdcZuoraClient;
import org.mule.modules.zuora.zuora.api.ZuoraClient;
import org.mule.modules.zuora.zuora.api.ZuoraClientAdaptor;
import org.mule.modules.zuora.zuora.api.ZuoraException;

import com.zuora.api.object.AmendRequest;
import com.zuora.api.object.AmendResult;
import com.zuora.api.object.DeleteResult;
import com.zuora.api.object.SaveResult;
import com.zuora.api.object.SubscribeRequest;
import com.zuora.api.object.SubscribeResult;

import java.util.List;

/**
 * @author flbulgarelli
 */
@Module(name="zuora",
        namespace="http://repository.mulesoft.org/releases/org/mule/modules/mule-module-zuora",
        schemaLocation="http://repository.mulesoft.org/releases/org/mule/modules/mule-module-zuora/1.0/mule-zuora.xsd")
public class ZuoraModule 
{
    @Configurable
    @Optional
    private ZuoraClient<ZuoraException> client;
    @Configurable
    private String username;
    @Configurable
    private String password;
    @Configurable
    private String endpoint;
    
    /**
     * Batch creation of ZObjects associated to Subscriptions
     *
     * {@code <subscribe subscriptions-ref="#[variable:subscribtions]"/>} 
     * @param subscriptions
     * @return a subscription results list, one for each subscription 
     */
    @Processor
    public List<SubscribeResult> subscribe(List<SubscribeRequest> subscriptions)
    {
        return client.subscribe(subscriptions);
    }

    /**
     * Batch creation of ZObjects
     *
     * {@code <create>
     *          <zobjects>
     *              <zobject ref="#[variable:anObject]"/>
     *           </zobject>
     *         </create>}   
     * @param zobjects
     * @return a list of SaveResult, one for each ZObject  
     */
    @Processor
    public List<SaveResult> create(List<ZObject> zobjects)
    {
        return client.create(zobjects);
    }
    
    /**
     * Batch creation of invoces for accounts
     * 
     * {@code <generate zobjects-ref="#[variable:accounts]"/>}
     * @param zobjects 
     * @return a list of SaveResult, one for each ZObject
     */
    @Processor
    public List<SaveResult> generate(List<ZObject> zobjects)
    {
        return client.generate(zobjects);
    }

    /**
     * Batch update of ZObjects
     *
     * {@code <update zobjects-ref="#[variable:objects]"/>}
     * @param zobjects
     * @return a list of SaveResult, one for each ZObject 
     */
    @Processor
    public List<SaveResult> update(List<ZObject> zobjects)
    {
        return client.update(zobjects);
    }
    
    /**
     * Batch delete of ZObjects
     * 
     * {@code <delete ids-ref="#[variable:ids]" type="#[variable:zobjectType]"/>}
     * @param type the type of ZObjects to delete 
     * @param ids 
     * @return a list of DeleteResults, one for each id 
     */
    @Processor
    public List<DeleteResult> delete(String type, List<String> ids)
    {
        return client.delete(type, ids);
    }
    
    /**
     * Lazily retrieves ZObject that match a given query, 
     * written in Zuora native query language
     *
     * {@code <find query="#[header:queryString]" />}
     * @param zquery
     * @return a ZObjects iterable
     */
    @Processor
    public Iterable<ZObject> find(String zquery)
    {
        return client.find(zquery);
    }
    
    /**
     * Answers user information
     *
     * {@code <get-user-info userId="#[header:userId]""/>}
     * @param userid
     * @return a User 
     */
    @Processor
    public String getUserInfo()
    {
        return client.getUserInfo();
    }
    
    /**
     * Amends subscriptions
     *
     * {@code <amend amendaments-ref="#[header:amendamentsList]"/>}
     * @param amendaments 
     * @return a list of AmmendResults, one for each amendament
     */
    @Processor
    public List<AmendResult> amend(List<AmendRequest> amendaments)
    {
        return client.amend(amendaments);
    }    
    
    //@Start
    public void init() throws Exception
    {
        if(client == null)
        {
            setClient(new SfdcZuoraClient(username, password, endpoint));
        }
    }
    
    public String getPassword()
    {
        return password;
    }
    
    public String getUsername()
    {
        return username;
    }
    
    public void setPassword(String password)
    {
        this.password = password;
    }
    
    public void setUsername(String username)
    {
        this.username = username;
    }
    
    public void setClient(ZuoraClient<?> client)
    {
        this.client = ZuoraClientAdaptor.adapt(client);
    }
    
    public void setEndpoint(String enpoint)
    {
        this.endpoint = enpoint;
    }
    
    public String getEnpoint()
    {
        return endpoint;
    }
}
